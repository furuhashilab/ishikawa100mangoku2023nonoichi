<html>
  <head>
    <meta charset="utf-8">
    <title>Mapbox Storytelling</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
    <link rel="icon" type="image/x-icon" href="https://raw.githubusercontent.com/mapbox/assembly/publisher-staging/src/svgs/mapbox.svg">
    <script src="https://api.tiles.mapbox.com/mapbox-gl-js/v2.11.0/mapbox-gl.js"></script>
    <link href="https://api.tiles.mapbox.com/mapbox-gl-js/v2.11.0/mapbox-gl.css" rel="stylesheet">
    <script src="https://unpkg.com/intersection-observer@0.12.0/intersection-observer.js"></script>
    <script src="https://unpkg.com/scrollama"></script>
    <style>
        body {
            margin:0;
            padding:0;
            font-family: sans-serif;
        }
        a, a:hover, a:visited {
            color: #0071bc;
        }
        #map {
            top:0;
            height: 100vh;
            width:100vw;
            position: fixed;
        }
        #mapInset {
            bottom:50px;
            right:30px;
            height: 180px;
            width:250px;
            max-width:100%;
            position: fixed;
            z-index: 1;
            opacity: 1;
            transition: opacity 0.5s ease-in-out;
            pointer-events: none;
        }
        #mapInset .mapboxgl-ctrl-bottom-left{
            display: none;
        }
        @media (max-width: 500px) {
            #mapInset {
                display: none;
            }
        }
        #header {
            margin: auto;
            width: 100%;
            position: relative;
            z-index: 5;
        }
        #header h1, #header h2, #header p {
            margin: 0;
            padding: 2vh 2vw;
            text-align: center;
        }
        #footer {
            width: 100%;
            min-height: 5vh;
            padding-top: 2vh;
            padding-bottom: 2vh;
            text-align: center;
            line-height: 25px;
            font-size: 13px;
            position: relative;
            z-index: 5;
        }
        #features {
            padding-top: 10vh;
            padding-bottom: 10vh;
        }
        .hidden {
            visibility: hidden;
        }
        .centered {
            width: 50vw;
            margin: 0 auto;
        }
        .lefty {
            width: 33vw;
            margin-left: 5vw;
        }
        .righty {
            width: 33vw;
            margin-left: 62vw;
        }
        .fully {
            width: 100%;
            margin: auto;
        }
        .light {
            color: #444;
            background-color: #fafafa;
        }
        .dark {
            color: #fafafa;
            background-color: #444;
        }
        .step {
            padding-bottom: 50vh;
            /* margin-bottom: 10vh; */
            opacity: 0.25;
        }
        .step.active {
            opacity: 0.9;
        }

        .step div {
            padding:  25px 50px;
            line-height: 25px;
            font-size: 13px;
        }

        .step img {
            width: 100%;
        }

        @media (max-width: 750px) {
            .centered, .lefty, .righty, .fully {
                width: 90vw;
                margin: 0 auto;
            }
        }

        /* Fix issue on mobile browser where scroll breaks  */
        .mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,
        .mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas {
            touch-action: unset;
        }

        </style>
</head>
<body>

<div id="map" class="mapboxgl-map"><div class="mapboxgl-canary" style="visibility: hidden;"></div><div class="mapboxgl-canvas-container"><canvas class="mapboxgl-canvas" tabindex="0" aria-label="Map" role="region" width="1770" height="1582" style="width: 885px; height: 791px;"></canvas></div><div class="mapboxgl-control-container"><div class="mapboxgl-ctrl-top-left"></div><div class="mapboxgl-ctrl-top-right"></div><div class="mapboxgl-ctrl-bottom-left"><div class="mapboxgl-ctrl" style="display: block;"><a class="mapboxgl-ctrl-logo" target="_blank" rel="noopener nofollow" href="https://www.mapbox.com/" aria-label="Mapbox logo"></a></div></div><div class="mapboxgl-ctrl-bottom-right"><div class="mapboxgl-ctrl mapboxgl-ctrl-attrib"><button class="mapboxgl-ctrl-attrib-button" type="button" aria-label="Toggle attribution"><span class="mapboxgl-ctrl-icon" aria-hidden="true" title="Toggle attribution"></span></button><div class="mapboxgl-ctrl-attrib-inner" role="list"><a href="https://www.mapbox.com/about/maps/" target="_blank" title="Mapbox" aria-label="Mapbox">© Mapbox</a> <a href="https://www.openstreetmap.org/about/" target="_blank" title="OpenStreetMap" aria-label="OpenStreetMap">© OpenStreetMap</a> <a class="mapbox-improve-map" href="https://apps.mapbox.com/feedback/?owner=wataruyoshida&amp;id=clmu8pv4y008f01rd6gbzf3ox&amp;access_token=pk.eyJ1Ijoid2F0YXJ1eW9zaGlkYSIsImEiOiJjbG45NmtkMXIwNG1zMmlxZDc5djVpa3ZiIn0.ZB20UsOlT-hFvHFDCNHjGg#/136.936/37.036/7.6" target="_blank" aria-label="Map feedback" rel="noopener nofollow">Improve this map</a></div></div></div></div></div>
<div id="mapInset"></div>
<div id="story"><div class="dark" id="header"><h1>いしかわ100万石　~19市町で描くGPSアート~</h1><h2>GPSアートを見ながら石川県内を巡っていきいましょう！</h2><p>By Wataru Yoshida, Minaho Ishii</p></div><div id="features"><div id="slug-style-id" class="step active righty" data-scrollama-index="0"><div class="dark"><h3>GPSアート in石川県</h3><p>本事業は石川県各市町で、各地域がもつ文化や地域の象徴をテーマに、観光スポットや文化資源をコースに取り入れたご当地GPSアートを制作します。 <br> アートを描く際には、その地域の人との交流を行いながら地域文化の魅力を再発見。出来上がったアートを地域文化の魅力とともにメッセージ化することで国民文化祭を盛り上げていきます。 <br> 各地域で創作したご当地GPSアートは「諸国漫遊 地上絵巻」として仕上げ、県民一体の国民文化祭、そして石川県の多様で多彩な地域文化をGPSアートとして表現します。</p></div></div><div id="second-identifier" class="step righty" data-scrollama-index="1"><div class="dark"><h3>朝顔　白山市</h3><img src="https://user-images.githubusercontent.com/93134160/269891930-33231cd2-6e94-4e50-b5ac-3f3494f2b416.jpg"><p>江戸時代の俳人・千代女は白山市出身。千代女は朝顔の句を多く詠んでいることから、朝顔は白山市の花になっています。若宮八幡宮・明達寺・千代女の里俳句館・本誓寺・聖興寺など白山市の観光スポットを巡ります。</p></div></div><div id="third-identifier" class="step lefty" data-scrollama-index="2"><div class="dark"><h3>次は石川県の特産品を見ていきましょう！</h3></div></div><div id="fourth-identifier" class="step righty" data-scrollama-index="3"><div class="dark"><h3>イカキング　能登町</h3><img src="https://user-images.githubusercontent.com/93134160/269909275-47ce8af0-72e5-47e3-8941-175d6aa4ea90.jpg"><p>日本有数のイカ釣り漁港がある能登町。漁港のそばの巨大モニュメント、イカキングは一躍話題となりました。日本百景に選ばれた九十九湾など風光明媚な里山里海を駆け巡り、能登町に巨大イカキングを描きます。</p></div></div><div id="fifth-identifier" class="step lefty" data-scrollama-index="4"><div class="dark"><h3>ころ柿　志賀町</h3><img src="https://user-images.githubusercontent.com/93134160/269905430-8dd50e02-0121-4708-ba24-eef087d469ad.jpg"><p>能登を代表する特産品、志賀町のころ柿は品種「最勝」を原料柿として、古くから伝わる伝統技法を用いて製造された糖度の高い干柿です。 志賀町の農家の軒先では干し柿がオレンジのカーテンのように吊るされています。</p></div></div><div id="sixth-identifier" class="step righty" data-scrollama-index="5"><div class="dark"><h3>福梅　金沢市</h3><img src="https://user-images.githubusercontent.com/93134160/269911787-49a59cae-7458-4d3b-aa89-3771865ba2af.jpg"><p>金沢では、お正月に梅の形をした紅白の最中、福梅を食べる風習があります。この福梅のルーツは加賀百万石の殿様、前田家の家紋「梅鉢紋」に由来しています。和菓子の町、金沢で和菓子屋さん巡りはいかがでしょう。</p></div></div><div id="seventh-identifier" class="step righty" data-scrollama-index="6"><div class="dark"><h3>フグ　白山市</h3><img src="https://user-images.githubusercontent.com/93134160/269903710-1f0165e3-4626-4ff1-9b26-9c8e596b159e.jpg"><p>霊峰白山の恵み大地のミネラルを大量に含んだ伏流水は、醗酵食文化を生み出しました。江戸時代より伝わる美川ふぐの子糠漬は、猛毒のふぐの卵巣を使った奇跡の発酵食品として文化庁「100年フード」に認定されています。</p></div></div><div id="eighth-identifier" class="step lefty" data-scrollama-index="7"><div class="dark"><h3>日本酒　白山市</h3><img src="https://user-images.githubusercontent.com/93134160/269913779-3eb426b8-4dcf-4842-938e-77b744404f8d.jpg"><p>白山市は霊峰白山から流れる手取川の伏流水と加賀平野の良質な酒米を用いた日本酒の一大生産地として古より知られております。見渡すかぎり田んぼののどかな扇状地。「手取川」吉田酒造、「天狗舞」車多酒造を巡ります。</p></div></div><div id="ninth-identifier" class="step righty" data-scrollama-index="8"><div class="dark"><h3>石川県の海岸線はどうなっているでしょうか。見てみましょう！</h3></div></div><div id="tenth-identifier" class="step righty" data-scrollama-index="9"><div class="dark"><h3>猿　珠洲市</h3><img src="https://user-images.githubusercontent.com/93134160/269915961-0a831ea8-0db2-48c7-b1e1-5fbf20b96f1f.jpg"><p>奥能登には猿にまつわる伝説・伝承が多数残っています。そして珠洲の海岸線は猿の顔そのもの。激坂の山越え、趣の異なる外浦と内浦の海岸線、風情ある珠洲の街並みとバリエーションに富んだコースになっています。</p></div></div><div id="eleventh-identifier" class="step righty" data-scrollama-index="10"><div class="dark"><h3>うさぎ　七尾市</h3><img src="https://user-images.githubusercontent.com/93134160/269916947-25ec5eb2-bda0-431a-8d1c-a171f2088daa.jpg"><p>七尾湾の中に浮かんでいる能登島の海岸線は、美しい海とおだやかな入江、荒波に削られた岩々など変化にとんだ景色が広がっています。海岸線の道路をつないでいくと大きなうさぎが浮かびあがること、ご存じでしたか？</p></div></div><div id="twelfth-identifier" class="step lefty" data-scrollama-index="11"><div class="dark"><h3>水の旅　白山市</h3><img src="https://user-images.githubusercontent.com/93134160/269920414-10b2521c-cd04-4c7d-8054-5eec091e3fdf.jpg"><p>白山手取川ジオパークは2023年、ユネスコ世界ジオパークに認定されました。白山に降った雪が水となり、手取川から日本海に流れる水の旅がテーマです。山頂から加賀禅定道～手取川～日本海までの水の旅を描きます。</p></div></div><div id="thirteenth-identifier" class="step lefty" data-scrollama-index="12"><div class="dark"><h3>わんじま　輪島市</h3><img src="https://user-images.githubusercontent.com/93134160/270154426-a748817a-7e02-4aab-9a4b-cb3058107933.jpg"><p>輪島漆芸美術館のゆるキャラ、わんじま。輪島塗のお椀がモチーフです。輪島漆芸美術館をスタートし、輪島塗スポットや輪島の朝市など観光名所を巡りながら出来上がったアートは、手に輪島塗のお箸を持ったわんじまです。</p></div></div><div id="fourteenth-identifier" class="step lefty" data-scrollama-index="13"><div class="dark"><h3>ボラ待ちやぐら　穴水町</h3><img src="https://user-images.githubusercontent.com/93134160/270154647-9325e492-58cc-4090-b54e-3469d03d89db.jpg"><p>終日、やぐらの上から海を見張り、魚群がくると網をたぐるという江戸時代からの伝統的漁法のボラ待ちやぐら。最盛期には40基のボラ待ちやぐらがあったそうです。ボラ待ちやぐら3基を巡ってやぐらのアートを描きます。</p></div></div><div id="fifteenth-identifier" class="step lefty" data-scrollama-index="14"><div class="dark"><h3>かも丸　加賀市</h3><img src="https://user-images.githubusercontent.com/93134160/270154928-04f20766-38f6-447a-8014-a11db0c60678.jpg"><p>加賀市にはラムサール条約に登録されている日本有数の鴨の越冬池や、江戸時代より伝わる伝統的鴨漁「坂網漁」など鴨にちなんだものが有名です。加賀市大聖寺で加賀市の公式キャラクターかも丸くんを描きます。</p></div></div><div id="sixteenth-identifier" class="step lefty" data-scrollama-index="15"><div class="dark"><h3>ゆ　加賀市</h3><img src="https://user-images.githubusercontent.com/93134160/270155257-a49d20da-d430-4d40-972f-682f8851316c.jpg"><p>山代温泉はあいうえお五十音図発祥の地。平安時代、明覚上人はお経を読むためサンスクリット語を学んでいるうちに、日本語に5つの母音があり、文字列がきれいに並ぶことを発見しました。ひらがなで温泉のゆを描きます。</p></div></div><div id="seventeenth-identifier" class="step lefty" data-scrollama-index="16"><div class="dark"><h3>続いては石川県にまつわる「言い伝え」をみていきましょう</h3></div></div><div id="eightteenth-identifier" class="step righty" data-scrollama-index="17"><div class="dark"><h3>白鷺　七尾市</h3><img src="https://user-images.githubusercontent.com/93134160/270162751-e8306876-4b6e-495d-99db-b9eb270b9cab.jpg"><p>日本では珍しい海から温泉が湧き出ている和倉温泉。七尾湾で一羽の白鷺が傷を癒していたのを漁師夫婦が見つけ、不思議に思い近づいてみると海中から温泉が湧き出ていた。これが和倉温泉の発祥とされています。</p></div></div><div id="nineteenth-identifier" class="step lefty" data-scrollama-index="18"><div class="dark"><h3>UＦＯキャッチャー 羽咋市</h3><img src="https://user-images.githubusercontent.com/93134160/270162993-7cd2941d-b752-41a5-a157-bb1f0ced9895.jpg"><p>UFOの町羽咋。気多大社の横にある正覚院の「気多古縁起」という古い巻物の中には、神力自在に飛ぶ物体が登場したということが由来だそうです。コスモアイル羽咋にはロケットや宇宙船の実物が展示されています。</p></div></div><div id="twentieth-identifier" class="step lefty" data-scrollama-index="19"><div class="dark"><h3>モーゼ　宝達志水町</h3><img src="https://user-images.githubusercontent.com/93134160/270163320-ded9d085-4673-46b2-926d-e64a58a4e104.jpg"><p>宝達志水町モーゼパークには、旧約聖書「十戒」で海を割ったモーゼの墓があります。ユダヤの民衆をイスラエルの地へ導いた後、不思議な天浮船で宝達山にどり着き、余生をこの地で過ごしたという言い伝えがあります。</p></div></div><div id="twenty-first-identifier" class="step lefty" data-scrollama-index="20"><div class="dark"><h3>牛王印　白山市</h3><img src="https://user-images.githubusercontent.com/93134160/270163791-b0892231-5752-4853-8624-53ac7f2a90ba.jpg"><p>平安時代に開かれた加賀禅定道は巨大な扇状地の頂点にある白山比咩神社を起点に、白山へと至る歴史ある信仰の道。白山に登る修験者の安全を祈願するお守りとして使われていた牛王印を手取川扇状地全体に描きます。</p></div></div><div id="twenty-second-identifier" class="step lefty" data-scrollama-index="21"><div class="dark"><h3>祭礼・行事についてみていきましょう！</h3></div></div><div id="twenty-third-identifier" class="step lefty" data-scrollama-index="22"><div class="dark"><h3>でか山　七尾市</h3><img src="https://user-images.githubusercontent.com/93134160/270164290-f2b6c866-568d-4e29-b160-25d3ef9f22dd.jpg"><p>日本一のでか山を誇る青柏祭の起源は平安時代。疫病退散を祈願する天王信仰を背景に伝承されています。青柏祭の大地主神社や小丸山城址公園、一本杉通り、山の寺寺院群、国分寺跡を巡り七尾城にでか山を引き上げます。</p></div></div><div id="twenty-fourth-identifier" class="step lefty" data-scrollama-index="23"><div class="dark"><h3>駅伝　津幡町</h3><img src="https://user-images.githubusercontent.com/93134160/270164589-3c62e72a-b9f2-4845-a00e-0a9a09f21abc.jpg"><p>河北潟一周駅伝は箱根駅伝と同じ大正9年（1920年）から始まった日本最古の駅伝であり、開催回数は100回を超える伝統的な大会。襷をつないでゴールテープを切るランナーをゴール地点の津幡町で描きます。</p></div></div><div id="twenty-fifth-identifier" class="step lefty" data-scrollama-index="24"><div class="dark"><h3>凧　内灘町</h3><img src="https://user-images.githubusercontent.com/93134160/270165141-842e5ad6-3414-426d-b20e-65960028e113.jpg"><p>毎年5月に内灘海水浴場で行われる内灘 世界の凧の祭典は、県内外そして海外からたくさんの人が集まる凧の祭典です。アート上にある凧会館では凧づくり体験を行うことができ、内灘海岸では凧あげも楽しめます</p></div></div><div id="twenty-sixth-identifier" class="step lefty" data-scrollama-index="25"><div class="dark"><h3>石川県の歴史・文化、偉人についてみていきましょう。</h3></div></div><div id="twenty-seventh-identifier" class="step lefty" data-scrollama-index="26"><div class="dark"><h3>禅　輪島市</h3><img src="https://user-images.githubusercontent.com/93134160/270166775-72a784f7-e083-4de7-b916-718fbdbcb25f.jpg"><p>かつて北前船の寄港地として栄えた輪島市門前にある総持寺祖院。海を通じて禅の文化を全国に広めました。また總持寺峨山禅師は、羽咋市永光寺の住職を兼ねており、両寺を結ぶ13里（52km）を往来していたそうです。</p></div></div><div id="twenty-eighth-identifier" class="step lefty" data-scrollama-index="27"><div class="dark"><h3>おにぎり　中能登町</h3><img src="https://user-images.githubusercontent.com/93134160/270167165-b124a342-1986-475c-a6cd-cb2cce3fb133.jpg"><p>おにぎりの里　中能登町。その由来は日本最古のおにぎりが出土したことから。1987年に弥生時代の竪穴住居跡からチマキ状炭化米の塊（おにぎりの化石）が発見されました。以降、おにぎりで町おこしがおこなわれています、</p></div></div><div id="twenty-ninth-identifier" class="step lefty" data-scrollama-index="28"><div class="dark"><h3>侍　金沢市</h3><img src="https://user-images.githubusercontent.com/93134160/270169772-9172c919-6388-4d35-80ab-d5d2caa4db14.jpg"><p>戦火を免れた金沢は、江戸時代から道筋がほとんど変わっていない城下町。昔ながらの町屋が多数残り、町並みそのものが観光名所。金沢城を中心に武家屋敷跡や金沢五社、金沢三茶屋街、金沢三寺院群などを巡ります。</p></div></div><div id="thirtieth-identifier" class="step lefty" data-scrollama-index="29"><div class="dark"><h3>富樫氏　野々市市</h3><img src="https://user-images.githubusercontent.com/93134160/270173563-5cfc37e1-4cbd-45ec-8985-55b6fe818be1.jpg"><p>富樫氏は、室町時代に加賀国を支配した守護大名。それ以前も木曽義仲との対戦や、源義経の勧進帳など歴史の舞台に度々登場しています。守護所を置いた富樫館跡や、富樫氏が建てた布市神社、喜多家住宅などを巡ります。</p></div></div><div id="thirty-first-identifier" class="step lefty" data-scrollama-index="30"><div class="dark"><h3>埴輪　能美市</h3><img src="https://user-images.githubusercontent.com/93134160/270174024-c9f7b5ae-fef2-41c4-985c-3f233ca72efb.jpg"><p>能美古墳群、寺井山→末寺山→和田山（２座）→秋常山→西山を繋ぎ埴輪を描きます。能美ふるさとミュージアムでは遺跡で発掘された壺や宝剣・埴輪などを見学。今年は加賀立国能美誕生1200年。能美市のルーツを探ります。</p></div></div><div id="thirty-second-identifier" class="step lefty" data-scrollama-index="31"><div class="dark"><h3>考える人　かほく市</h3><img src="https://user-images.githubusercontent.com/93134160/270174576-2d8e81ca-a3be-484b-96dc-6c0142886377.jpg"><p>かほく市が生んだ日本近代哲学の偉人、西田幾多郎。幾多郎の生誕地から生い立ちの地、西田幾多郎哲学館、哲学の道、幾多郎のお墓など幾多郎のルーツを巡っていくと、「考える人」が町に浮かびあがります。</p></div></div><div id="thirty-third-identifier" class="step lefty" data-scrollama-index="32"><div class="dark"><h3>野球　能美市</h3><img src="https://user-images.githubusercontent.com/93134160/270175053-380a0e13-4d19-43e9-8a60-87d215489bb9.jpg"><p>巨人・NYヤンキースで活躍した松井秀喜さんは石川県能美市出身。松井秀喜ベースボールミュージアムを起点に松井さんの母校（浜小学校、根上中学）をはじめ、根上りの松、弁慶謝罪の地などを巡ります。</p></div></div><div id="thirty-forth-identifier" class="step lefty" data-scrollama-index="33"><div class="dark"><h3>松尾芭蕉　加賀市</h3><img src="https://user-images.githubusercontent.com/93134160/270504183-7d81f91d-0dbc-4b85-9f1b-1881ce97f1b4.jpg"><p>開湯1300年の歴史を持つ山中温泉は、芭蕉が称賛した日本三大名湯の1つ。1689年夏、奥の細道の道中、松尾芭蕉は山中温泉に長期にわたって滞在しました。山中温泉の数々の名所旧跡には芭蕉の句が残されています。</p></div></div><div id="thirty-fifth-identifier" class="step lefty" data-scrollama-index="34"><div class="dark"><h3>深田久弥　加賀市</h3><img src="https://user-images.githubusercontent.com/93134160/270506131-491624c9-da6a-45e1-8546-0dd56c9d6031.jpg"><p>日本人はたいていふるさとの山を持っている。「日本百名山」著者、深田久弥は加賀市大聖寺出身。深田久弥山の文化館でルーツを探り、久弥が愛した白山を眺めながら生まれ育った大聖寺の城下町をめぐります。</p></div></div><div id="thirty-sixth-identifier" class="step lefty" data-scrollama-index="35"><div class="dark"><h3>がんばろうスズ　珠洲市</h3><img src="https://user-images.githubusercontent.com/93134160/270507015-f6c5b409-3fcb-4a4d-9500-e7addbe40d84.jpg"><p>2023年5月、大きな震災にあった珠洲。夏にはトライアスロン珠洲、秋には奥能登国際芸術祭が数年ぶりに開催されます。スポーツとアートの力、そしてみんなの強い気持ちと団結で乗り越えていきましょう。がんばろうスズ</p></div></div><div id="thirty-seventh-identifier" class="step lefty" data-scrollama-index="36"><div class="dark"><h3>ONE TEAM　石川１９市町</h3><p>長く続いたコロナ禍や地震、豪雨災害を乗り越え、皆が活力を取り戻すために。いしかわ百万石文化祭・新幹線開業・世界ジオパークなど皆で盛り上げるために。オール石川のチジョウエール、ONE TEAMを描きます。</p></div></div><div id="thirty-eighth-chapter" class="step centered" data-scrollama-index="37"><div class="dark"><h3>最後に</h3><p>ここまで30のGPSアートを石川県内でみてきました。いかがでしたでしょうか？ <br> 特産品や伝統芸能など石川県ならではの魅力を感じでいただけたら嬉しいです。今回GPSアートで紹介したもので気になった・興味があるスポットにぜひ足を運んでみてください！ <br> <br> Thank you for watching!!</p></div></div></div><div class="dark" id="footer"><p>Source: source citations, etc. <br> Created using <a href="https://github.com/mapbox/storytelling" target="_blank">Mapbox Storytelling</a> template.</p></div></div>

<script src="./config.js"></script>
<script>
var initLoad = true;
var layerTypes = {
    'fill': ['fill-opacity'],
    'line': ['line-opacity'],
    'circle': ['circle-opacity', 'circle-stroke-opacity'],
    'symbol': ['icon-opacity', 'text-opacity'],
    'raster': ['raster-opacity'],
    'fill-extrusion': ['fill-extrusion-opacity'],
    'heatmap': ['heatmap-opacity']
}

var alignments = {
    'left': 'lefty',
    'center': 'centered',
    'right': 'righty',
    'full': 'fully'
}

function getLayerPaintType(layer) {
    var layerType = map.getLayer(layer).type;
    return layerTypes[layerType];
}

function setLayerOpacity(layer) {
    var paintProps = getLayerPaintType(layer.layer);
    paintProps.forEach(function(prop) {
        var options = {};
        if (layer.duration) {
            var transitionProp = prop + "-transition";
            options = { "duration": layer.duration };
            map.setPaintProperty(layer.layer, transitionProp, options);
        }
        map.setPaintProperty(layer.layer, prop, layer.opacity, options);
    });
}

var story = document.getElementById('story');
var features = document.createElement('div');
features.setAttribute('id', 'features');

var header = document.createElement('div');

if (config.title) {
    var titleText = document.createElement('h1');
    titleText.innerText = config.title;
    header.appendChild(titleText);
}

if (config.subtitle) {
    var subtitleText = document.createElement('h2');
    subtitleText.innerText = config.subtitle;
    header.appendChild(subtitleText);
}

if (config.byline) {
    var bylineText = document.createElement('p');
    bylineText.innerText = config.byline;
    header.appendChild(bylineText);
}

if (header.innerText.length > 0) {
    header.classList.add(config.theme);
    header.setAttribute('id', 'header');
    story.appendChild(header);
}

config.chapters.forEach((record, idx) => {
    var container = document.createElement('div');
    var chapter = document.createElement('div');

    if (record.title) {
        var title = document.createElement('h3');
        title.innerText = record.title;
        chapter.appendChild(title);
    }

    if (record.image) {
        var image = new Image();
        image.src = record.image;
        chapter.appendChild(image);
    }

    if (record.description) {
        var story = document.createElement('p');
        story.innerHTML = record.description;
        chapter.appendChild(story);
    }

    container.setAttribute('id', record.id);
    container.classList.add('step');
    if (idx === 0) {
        container.classList.add('active');
    }

    chapter.classList.add(config.theme);
    container.appendChild(chapter);
    container.classList.add(alignments[record.alignment] || 'centered');
    if (record.hidden) {
        container.classList.add('hidden');
    }
    features.appendChild(container);
});

story.appendChild(features);

var footer = document.createElement('div');

if (config.footer) {
    var footerText = document.createElement('p');
    footerText.innerHTML = config.footer;
    footer.appendChild(footerText);
}

if (footer.innerText.length > 0) {
    footer.classList.add(config.theme);
    footer.setAttribute('id', 'footer');
    story.appendChild(footer);
}

mapboxgl.accessToken = config.accessToken;

const transformRequest = (url) => {
    const hasQuery = url.indexOf("?") !== -1;
    const suffix = hasQuery ? "&pluginName=scrollytellingV2" : "?pluginName=scrollytellingV2";
    return {
      url: url + suffix
    }
}

var map = new mapboxgl.Map({
    container: 'map',
    style: config.style,
    center: config.chapters[0].location.center,
    zoom: config.chapters[0].location.zoom,
    bearing: config.chapters[0].location.bearing,
    pitch: config.chapters[0].location.pitch,
    interactive: false,
    transformRequest: transformRequest,
    projection: config.projection
});

// Create a inset map if enabled in config.js
if (config.inset) {
 var insetMap = new mapboxgl.Map({
    container: 'mapInset', // container id
    style: 'mapbox://styles/mapbox/dark-v10', //hosted style id
    center: config.chapters[0].location.center,
    // Hardcode above center value if you want insetMap to be static.
    zoom: 3, // starting zoom
    hash: false,
    interactive: false,
    attributionControl: false,
    //Future: Once official mapbox-gl-js has globe view enabled,
    //insetmap can be a globe with the following parameter.
    //projection: 'globe'
  });
}

if (config.showMarkers) {
    var marker = new mapboxgl.Marker({ color: config.markerColor });
    marker.setLngLat(config.chapters[0].location.center).addTo(map);
}

// instantiate the scrollama
var scroller = scrollama();


map.on("load", function() {
    if (config.use3dTerrain) {
        map.addSource('mapbox-dem', {
            'type': 'raster-dem',
            'url': 'mapbox://mapbox.mapbox-terrain-dem-v1',
            'tileSize': 512,
            'maxzoom': 14
        });
        // add the DEM source as a terrain layer with exaggerated height
        map.setTerrain({ 'source': 'mapbox-dem', 'exaggeration': 1.5 });

        // add a sky layer that will show when the map is highly pitched
        map.addLayer({
            'id': 'sky',
            'type': 'sky',
            'paint': {
                'sky-type': 'atmosphere',
                'sky-atmosphere-sun': [0.0, 0.0],
                'sky-atmosphere-sun-intensity': 15
            }
        });
    };

    // As the map moves, grab and update bounds in inset map.
    if (config.inset) {
    map.on('move', getInsetBounds);
    }
    // setup the instance, pass callback functions
    scroller
    .setup({
        step: '.step',
        offset: 0.5,
        progress: true
    })
    .onStepEnter(async response => {
        var current_chapter = config.chapters.findIndex(chap => chap.id === response.element.id);
        var chapter = config.chapters[current_chapter];
        
        response.element.classList.add('active');
        map[chapter.mapAnimation || 'flyTo'](chapter.location);

        // Incase you do not want to have a dynamic inset map,
        // rather want to keep it a static view but still change the
        // bbox as main map move: comment out the below if section.
        if (config.inset) {
          if (chapter.location.zoom < 5) {
            insetMap.flyTo({center: chapter.location.center, zoom: 0});
          }
          else {
            insetMap.flyTo({center: chapter.location.center, zoom: 3});
          }
        }
        if (config.showMarkers) {
            marker.setLngLat(chapter.location.center);
        }
        if (chapter.onChapterEnter.length > 0) {
            chapter.onChapterEnter.forEach(setLayerOpacity);
        }
        if (chapter.callback) {
            window[chapter.callback]();
        }
        if (chapter.rotateAnimation) {
            map.once('moveend', () => {
                const rotateNumber = map.getBearing();
                map.rotateTo(rotateNumber + 180, {
                    duration: 30000, easing: function (t) {
                        return t;
                    }
                });
            });
        }
        if (config.auto) {
             var next_chapter = (current_chapter + 1) % config.chapters.length;
             map.once('moveend', () => {
                 document.querySelectorAll('[data-scrollama-index="' + next_chapter.toString() + '"]')[0].scrollIntoView();
             });
        }
    })
    .onStepExit(response => {
        var chapter = config.chapters.find(chap => chap.id === response.element.id);
        response.element.classList.remove('active');
        if (chapter.onChapterExit.length > 0) {
            chapter.onChapterExit.forEach(setLayerOpacity);
        }
    });


    if (config.auto) {
        document.querySelectorAll('[data-scrollama-index="0"]')[0].scrollIntoView();
    }
});

//Helper functions for insetmap
function getInsetBounds() {
            let bounds = map.getBounds();

            let boundsJson = {
                "type": "FeatureCollection",
                "features": [{
                    "type": "Feature",
                    "properties": {},
                    "geometry": {
                        "type": "Polygon",
                        "coordinates": [
                            [
                                [
                                    bounds._sw.lng,
                                    bounds._sw.lat
                                ],
                                [
                                    bounds._ne.lng,
                                    bounds._sw.lat
                                ],
                                [
                                    bounds._ne.lng,
                                    bounds._ne.lat
                                ],
                                [
                                    bounds._sw.lng,
                                    bounds._ne.lat
                                ],
                                [
                                    bounds._sw.lng,
                                    bounds._sw.lat
                                ]
                            ]
                        ]
                    }
                }]
            }

            if (initLoad) {
                addInsetLayer(boundsJson);
                initLoad = false;
            } else {
                updateInsetLayer(boundsJson);
            }

        }

function addInsetLayer(bounds) {
    insetMap.addSource('boundsSource', {
        'type': 'geojson',
        'data': bounds
    });

    insetMap.addLayer({
        'id': 'boundsLayer',
        'type': 'fill',
        'source': 'boundsSource', // reference the data source
        'layout': {},
        'paint': {
            'fill-color': '#fff', // blue color fill
            'fill-opacity': 0.2
        }
    });
    // // Add a black outline around the polygon.
    insetMap.addLayer({
        'id': 'outlineLayer',
        'type': 'line',
        'source': 'boundsSource',
        'layout': {},
        'paint': {
            'line-color': '#000',
            'line-width': 1
        }
    });
}

function updateInsetLayer(bounds) {
    insetMap.getSource('boundsSource').setData(bounds);
}



// setup resize event
window.addEventListener('resize', scroller.resize);

</script>



</body>
</html>
